<!DOCTYPE html>
<html lang="my" data-theme="light" data-font="base">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>BuddhaCollege</title>
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Ctext y='0.9em' font-size='96'%3E%F0%9F%93%96%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@300;400;600;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <!-- Topbar -->
  <header class="topbar shadow">
    <div class="row">
      <div class="brand">BuddhaCollege</div>
      <div class="space"></div>
      <span id="authState" class="pill">Guest</span>
      <button id="btnTopSignIn"  class="btn sm" onclick="openLogin()">Sign in</button>
      <button id="btnTopSignOut" class="btn sm" style="display:none">Sign out</button>
    </div>
  </header>

  <!-- Nav + settings -->
  <nav id="mainNav" class="nav shadow">
    <button class="active" data-tab="home"   onclick="tab(this,'home')">🏠 Home</button>
    <button              data-tab="events" onclick="tab(this,'events')">📅 Events</button>
    <button              data-tab="donate" onclick="tab(this,'donate')">🙏 Donate</button>
    <button              data-tab="records" onclick="tab(this,'records')">📘 Records</button>
    <button              data-tab="admin" id="btnTabAdmin" onclick="tab(this,'admin')" style="display:none">🔐 Admin</button>
    <div class="space"></div>
    <div class="row settings-inline">
      <select id="selTheme" class="opt">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="warm">Warm</option>
        <option value="emerald">Emerald</option>
        <option value="ocean">Ocean</option>
        <option value="rose">Rose</option>
      </select>
      <select id="selFont" class="opt">
        <option value="small">A-</option>
        <option value="base" selected>A</option>
        <option value="large">A+</option>
      </select>
    </div>
  </nav>

  <!-- HOME -->
  <main id="home" class="section active">
    <div class="wrap">
      <div class="hero card gradient">
        <h1>နေ့စဉ်လုပ်ငန်း</h1>
        <p class="muted">ပုံ/စာ/ဗီဒီယို/အသံ ဖြင့် လှလှပပ ပြသထားပါသည်။</p>
        <form id="signupForm" class="row" onsubmit="signup(event)">
          <input id="signupEmail" type="email" inputmode="email" placeholder="Email (အသစ်တင်ရင် အော်တို အသိပေး)" required>
          <button class="btn primary" type="submit">Sign up</button>
        </form>
      </div>
      <div id="postGrid" class="grid cards"></div>
      <div id="homeEmpty" class="empty">တင်ထားသော ပို့စ်မရှိသေးပါ…</div>
    </div>
  </main>

  <!-- EVENTS -->
  <section id="events" class="section">
    <div class="wrap">
      <div class="row toolbar">
        <h2 class="title">အခါကြီး/ရက်ကြီးများ</h2>
        <div class="space"></div>
        <div class="row month-nav">
          <button class="btn" onclick="prevMonth()">←</button>
          <div id="monthLabel" class="pill"></div>
          <button class="btn" onclick="nextMonth()">→</button>
        </div>
      </div>
      <div id="eventUpcoming" class="list"></div>
      <h3 class="mt">ဤလ (Admin များအတွက် အကွက်တိုင်း စာရေးနိုင်)</h3>
      <div id="cal" class="calendar"></div>
    </div>
  </section>

  <!-- DONATE -->
  <section id="donate" class="section">
    <div class="wrap">
      <div class="card">
        <h2 class="row">Donations <span class="badge">KBZPay • CBPay • AYAPay</span></h2>
        <div class="grid three">
          <div class="card inset">
            <h3>KBZPay</h3>
            <img id="qrKBZ" class="qr" alt="KBZPay QR">
            <p class="note" id="kbzNote"></p>
          </div>
          <div class="card inset">
            <h3>CBPay</h3>
            <img id="qrCB" class="qr" alt="CBPay QR">
            <p class="note" id="cbNote"></p>
          </div>
          <div class="card inset">
            <h3>AYAPay</h3>
            <img id="qrAYA" class="qr" alt="AYAPay QR">
            <p class="note" id="ayaNote"></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- RECORDS -->
  <section id="records" class="section">
    <div class="wrap">
      <div class="card gradient">
        <h2>နှစ်စဉ်မှတ်တမ်း</h2>
        <p class="muted nonadmin-note">Admin မပါလျှင် ဖတ်ရုံသာ — cloud တွင် သိမ်းထားသော data များကို မည်သည့် device မှ မဆို ပြပေးသည်။</p>
      </div>
      <div class="row toolbar">
        <input id="recYear" type="number" placeholder="Year e.g. 2025">
        <input id="recQuery" type="search" placeholder="အမည် / ဖုန်း / Email ရိုက်ရှာ">
        <button class="btn" onclick="searchRecords()">Search</button>
      </div>
      <div id="recGrid" class="grid cards"></div>
      <div id="recEmpty" class="empty">Admin အတွက်သာ…</div>
    </div>
  </section>

  <!-- ADMIN (still available after login) -->
  <section id="admin" class="section" style="display:none">
    <div class="wrap">
      <div class="grid two">
        <div class="card inset">
          <h3>ပို့စ်အသစ်တင်ရန် (Raw HTML အပါအဝင်)</h3>
          <form id="postForm" onsubmit="createPost(event)">
            <input id="pTitle" required placeholder="ခေါင်းစဉ်">
            <label class="row" style="gap:8px">
              <input id="pAllowHTML" type="checkbox" checked> <span class="note">Allow raw HTML</span>
            </label>
            <div id="blocks" class="blocks"></div>
            <div class="row wrap gap">
              <button class="btn" type="button" onclick="addBlock('text')">＋ Text/HTML</button>
              <button class="btn" type="button" onclick="addBlock('image')">＋ Image</button>
              <button class="btn" type="button" onclick="addBlock('video')">＋ Video</button>
              <button class="btn" type="button" onclick="addBlock('audio')">＋ Audio</button>
            </div>
            <div class="row gap mt">
              <button class="btn primary" type="submit">Publish</button>
              <button class="btn" type="button" onclick="seedDemo()">Load Sample Data</button>
              <span id="postMsg" class="note"></span>
            </div>
          </form>
        </div>

        <div class="card inset">
          <h3>Donations & Events</h3>
          <input id="kbzNoteIn" placeholder="KBZPay note">
          <input id="cbNoteIn" placeholder="CBPay note">
          <input id="ayaNoteIn" placeholder="AYAPay note">
          <div class="row gap">
            <label class="file"><span>KBZ QR</span><input id="kbzQR" type="file" accept="image/*"></label>
            <label class="file"><span>CB QR</span><input id="cbQR" type="file" accept="image/*"></label>
            <label class="file"><span>AYA QR</span><input id="ayaQR" type="file" accept="image/*"></label>
          </div>
          <button class="btn" onclick="saveDonation()">Save Donation Setup</button>

          <hr class="line">
          <h4>Event Add</h4>
          <div class="row gap wrap">
            <input id="evTitle" placeholder="Event title">
            <input id="evDate" type="date">
            <textarea id="evDesc" placeholder="Event description (optional)"></textarea>
            <button class="btn" onclick="addEvent()">Add</button>
          </div>
        </div>
      </div>

      <div class="card inset">
        <h3>နှစ်စဉ် မှတ်တမ်းတင်ရန်</h3>
        <form id="recForm" onsubmit="saveRecord(event)">
          <div class="grid two">
            <input id="rYear"   type="number" required placeholder="Year">
            <input id="rName"   required placeholder="အမည်">
            <input id="rAge"    type="number" placeholder="အသက်">
            <input id="rNRC"    placeholder="မှတ်ပုံတင်">
            <input id="rEdu"    placeholder="ပညာအရည်အချင်း">
            <input id="rMother" placeholder="အမိအမည်">
            <input id="rFather" placeholder="အဖအမည်">
            <input id="rRole"   placeholder="လက်ရှိရာထူး">
            <input id="rPhone"  placeholder="ဖုန်း">
            <input id="rEmail"  type="email" placeholder="Email">
            <label class="file"><span>ဓာတ်ပုံ</span><input id="rPhoto" type="file" accept="image/*"></label>
          </div>
          <div class="row gap mt">
            <button class="btn primary" type="submit">Save Record</button>
            <span id="recMsg" class="note"></span>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" onclick="closeLogin()"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="row">
        <h3 id="loginTitle">Admin Sign in</h3>
        <div class="space"></div>
        <button class="btn sm" onclick="closeLogin()">✕</button>
      </div>
      <input id="mEmail" type="email" placeholder="admin email" autocomplete="username">
      <input id="mPass" type="password" placeholder="password" autocomplete="current-password"
             onkeydown="if(event.key==='Enter'){loginModal()}">
      <div class="row">
        <button class="btn primary" onclick="loginModal()">Sign in</button>
      </div>
      <p class="note small">Admin မဟုတ်လျှင် Posts/Events/Donations များကို ကြည့်နိုင်ပါသည်။</p>
    </div>
  </div>

  <footer class="footer">© <span id="year"></span> Bhikkhu • Firebase</footer>

  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js').catch(()=>{}));
    }
  </script>
</body>
</html>