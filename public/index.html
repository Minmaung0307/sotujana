<!DOCTYPE html>
<html lang="my" data-theme="light" data-font="base">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ဘုန်းကြီးကျောင်း App • Bhikkhu School</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@300;400;500;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar">
    <div class="row">
      <button class="icon-btn" id="btnMenu" aria-label="Toggle navigation">☰</button>
      <h1>ဘုန်းကြီးကျောင်း App</h1>
      <div class="space"></div>
      <span id="authState" class="pill">Guest</span>
      <button id="btnAdmin" class="btn sm" onclick="show('admin')">Admin</button>
    </div>
    <div id="upcomingWarn" class="warn-banner" role="status" aria-live="polite"></div>
  </header>

  <nav id="mainNav" class="nav">
    <button class="active" data-tab="home" onclick="tab(this,'home')">🏠 Home</button>
    <button data-tab="history" onclick="tab(this,'history')">🗂️ History</button>
    <button data-tab="donate" onclick="tab(this,'donate')">🙏 Donate</button>
    <button data-tab="events" onclick="tab(this,'events')">📅 Events</button>
    <button data-tab="records" onclick="tab(this,'records')">📘 Records</button>
    <div class="divider"></div>
    <details class="settings">
      <summary>⚙️ Settings</summary>
      <div class="settings-panel">
        <label>Theme</label>
        <div class="seg">
          <button class="seg-btn" data-theme="light">Light</button>
          <button class="seg-btn" data-theme="dark">Dark</button>
          <button class="seg-btn" data-theme="warm">Warm</button>
        </div>
        <label>Font size</label>
        <div class="seg">
          <button class="seg-btn" data-font="small">A-</button>
          <button class="seg-btn" data-font="base">A</button>
          <button class="seg-btn" data-font="large">A+</button>
        </div>
      </div>
    </details>
  </nav>

  <!-- HOME -->
  <main id="home" class="section active">
    <div class="wrap">
      <div class="row toolbar">
        <div class="pill">နေ့စဥ်လုပ်ငန်း • Daily Activities</div>
        <div class="space"></div>
        <form id="signupForm" class="row" onsubmit="signup(event)">
          <input id="signupEmail" type="email" inputmode="email" placeholder="Email (အသစ်တင်ရင် အော်တို အကြောင်းကြား)" required>
          <button class="btn primary" type="submit">Sign up</button>
        </form>
      </div>
      <div id="postGrid" class="grid"></div>
      <div id="homeEmpty" class="empty">ပို့စ်မရှိသေးပါ…</div>
    </div>
  </main>

  <!-- HISTORY -->
  <section id="history" class="section">
    <div class="wrap">
      <div class="row toolbar">
        <label class="sr-only" for="histMonth">Month</label>
        <select id="histMonth">
          <option value="">All</option>
          <option value="1">Jan</option><option value="2">Feb</option><option value="3">Mar</option>
          <option value="4">Apr</option><option value="5">May</option><option value="6">Jun</option>
          <option value="7">Jul</option><option value="8">Aug</option><option value="9">Sep</option>
          <option value="10">Oct</option><option value="11">Nov</option><option value="12">Dec</option>
        </select>
        <label class="sr-only" for="histYear">Year</label>
        <input id="histYear" type="number" placeholder="2025">
        <button class="btn" onclick="loadHistory()">Search</button>
        <div class="space"></div>
      </div>
      <div id="histGrid" class="grid"></div>
      <div id="histEmpty" class="empty">ရှာမတွေ့ပါ…</div>
    </div>
  </section>

  <!-- DONATE -->
  <section id="donate" class="section">
    <div class="wrap">
      <div class="card">
        <h2 class="row">🙏 လှူဒါန်းခြင်း • Donations <span class="badge">KBZPay • CBPay</span></h2>
        <p class="muted">QR ကို စကင်ဖတ်ပြီး လှူဒါန်းနိုင်ပါတယ်။ အော်နာမတ်ဗဗ…</p>
        <div class="grid two">
          <div class="card inset">
            <h3>KBZPay</h3>
            <img id="qrKBZ" class="qr" alt="KBZPay QR">
            <p class="note" id="kbzNote"></p>
          </div>
          <div class="card inset">
            <h3>CBPay</h3>
            <img id="qrCB" class="qr" alt="CBPay QR">
            <p class="note" id="cbNote"></p>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Newsletter</h3>
        <p class="muted">ပို့စ်အသစ်တင်တိုင်း Email ဖြင့် အသိပေး</p>
        <form onsubmit="signup(event)">
          <input id="signupEmail2" type="email" inputmode="email" placeholder="Email" required>
          <button class="btn primary" type="submit">Sign up</button>
        </form>
      </div>
    </div>
  </section>

  <!-- EVENTS -->
  <section id="events" class="section">
    <div class="wrap">
      <div class="row toolbar">
        <div class="pill">အခါကြီး/ရက်ကြီးများ</div><div class="space"></div>
        <div class="note">Admin မှ သတ်မှတ်ထားသော လာမည့်အခါကြီးများ</div>
      </div>
      <div id="eventUpcoming" class="list"></div>
      <h3 class="mt">This Month</h3>
      <div id="cal" class="calendar"></div>
    </div>
  </section>

  <!-- RECORDS -->
  <section id="records" class="section">
    <div class="wrap">
      <div class="row toolbar">
        <div class="pill">နှစ်စဥ်မှတ်တမ်း (Admin only)</div>
        <div class="space"></div>
        <input id="recYear" type="number" placeholder="Year e.g. 2025">
        <button class="btn" onclick="searchRecords()">Search</button>
      </div>
      <div id="recGrid" class="grid"></div>
      <div id="recEmpty" class="empty">Admin အတွက်သာ ဖြစ်ပါသည်…</div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="admin" class="section">
    <div class="wrap">
      <div class="card">
        <div class="row">
          <h2>Admin Panel</h2>
          <div class="space"></div>
          <input id="admEmail" type="email" placeholder="admin email">
          <input id="admPass" type="password" placeholder="password">
          <button class="btn primary" onclick="login()">Sign in</button>
          <button class="btn" onclick="logout()">Sign out</button>
        </div>
      </div>

      <div class="grid two">
        <div class="card inset">
          <h3>ပို့စ်အသစ်တင်ရန်</h3>
          <form id="postForm" onsubmit="createPost(event)">
            <input id="pTitle" required placeholder="ခေါင်းစဉ်">
            <textarea id="pBody" placeholder="အကြောင်းအရာ"></textarea>
            <div class="seg">
              <label class="seg-btn"><input type="radio" name="mtype" value="image" checked> Image</label>
              <label class="seg-btn"><input type="radio" name="mtype" value="video"> Video</label>
            </div>
            <input id="pFile" type="file" accept="image/*,video/*">
            <div class="row gap">
              <button class="btn primary" type="submit">Publish</button>
              <span id="postMsg" class="muted"></span>
            </div>
          </form>
        </div>

        <div class="card inset">
          <h3>Donations & Events</h3>
          <input id="kbzNoteIn" placeholder="KBZPay note e.g. Account Name">
          <input id="cbNoteIn" placeholder="CBPay note">
          <div class="row gap">
            <label class="file"><span>KBZ QR</span><input id="kbzQR" type="file" accept="image/*"></label>
            <label class="file"><span>CB QR</span><input id="cbQR" type="file" accept="image/*"></label>
          </div>
          <button class="btn" onclick="saveDonation()">Save Donation Setup</button>
          <hr class="line">
          <h4>Add Event</h4>
          <div class="row gap wrap">
            <input id="evTitle" placeholder="Event title">
            <input id="evDate" type="date">
            <button class="btn" onclick="addEvent()">Add</button>
          </div>
        </div>
      </div>

      <div class="card inset">
        <h3>နှစ်စဥ် မှတ်တမ်းတင်ရန် (Admin)</h3>
        <form id="recForm" onsubmit="saveRecord(event)">
          <div class="grid two">
            <input id="rYear" type="number" required placeholder="Year">
            <input id="rName" required placeholder="အမည်">
            <input id="rAge" type="number" placeholder="အသက်">
            <input id="rNRC" placeholder="မှတ်ပုံတင်">
            <input id="rEdu" placeholder="ပညာအရည်အချင်း">
            <input id="rMother" placeholder="အမိအမည်">
            <input id="rFather" placeholder="အဖအမည်">
            <input id="rRole" placeholder="လက်ရှိရာထူး">
            <label class="file"><span>ဓာတ်ပုံ</span><input id="rPhoto" type="file" accept="image/*"></label>
          </div>
          <div class="row gap mt">
            <button class="btn primary" type="submit">Save Record</button>
            <span id="recMsg" class="muted"></span>
          </div>
        </form>
      </div>
    </div>
  </section>

  <footer class="footer">
    © <span id="year"></span> Bhikkhu School • Firebase + EmailJS
  </footer>

  <!-- App scripts -->
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // SW register
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
